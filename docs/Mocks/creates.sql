CREATE TABLE FESTIVAL
(
  ID           NUMBER       NOT NULL,
  FECHA_INICIO DATE,
  FECHA_FIN    DATE,
  CIUDAD       VARCHAR2(25) NOT NULL,
  CONSTRAINT FESTIVAL_PK PRIMARY KEY (ID),
  CHECK ( FECHA_FIN > FECHA_INICIO )
);

CREATE TABLE USUARIOS
(
  IDENTFICACION      NUMBER       NOT NULL,
  TIPO_ID            VARCHAR2(10) NOT NULL,
  CORREO_ELECTRONICO VARCHAR2(32) NOT NULL,
  CONTRASENA         VARCHAR2(15) NOT NULL,
  NOMBRE             VARCHAR2(40) NOT NULL,
  ROL                VARCHAR2(30) NOT NULL,
  TELEFONO           NUMBER,
  ID_FESTIVAL        NUMBER       NOT NULL,
  CONSTRAINT USUARIO_PK PRIMARY KEY (IDENTFICACION, TIPO_ID),
  CONSTRAINT FK_FESTIVAL FOREIGN KEY (ID_FESTIVAL) REFERENCES FESTIVAL (ID_FESTIVAL),
  CHECK (ROL IN ( 'Administrador', 'Organizador', 'Usuario No-Registrado', 'Usuario Registrado', 'Compania De Teatro' ) )
);

CREATE TABLE CLIENTE_REGISTRADO
(
  ID_USUARIO NUMBER NOT NULL,
  EDAD       NUMBER NOT NULL,
  CONSTRAINT CLIENTE_REGISTRADO_PK PRIMARY KEY (ID_USUARIO),
  CONSTRAINT FK_CR_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIOS (IDENTFICACION),
  CHECK ( EDAD > 0 )
);

CREATE TABLE COMPANIA_TEATRO
(
  ID            NUMBER        NOT NULL,
  NOMBRE        VARCHAR2(255) NOT NULL,
  REPRESENTANTE VARCHAR2(255) NOT NULL,
  PAIS          VARCHAR2(255) NOT NULL,
  PAGINA_WEB    VARCHAR2(255),
  FECHA_LLEGADA DATE          NOT NULL,
  FECHA_SALIDA  DATE          NOT NULL,
  CONSTRAINT COMPANIA_PK PRIMARY KEY (ID),
  CONSTRAINT FK_CT_USUARIO FOREIGN KEY (ID) REFERENCES USUARIOS (IDENTFICACION),
  CHECK ( FECHA_SALIDA > FECHA_LLEGADA )
);

CREATE TABLE ESPECTACULO
(
  ID                    NUMBER        NOT NULL,
  NOMBRE                VARCHAR2(255) NOT NULL,
  DURACION              NUMBER        NOT NULL,
  IDIOMA                VARCHAR2(255) NOT NULL,
  COSTO_REALIZACION     NUMBER        NOT NULL,
  PARTICIPACION_PUBLICO NUMBER(0, 1),
  DESCRIPCION           VARCHAR2(255) NOT NULL,
  ID_GENERO             NUMBER        NOT NULL,
  ID_FESTIVAL           NUMBER        NOT NULL,
  ID_CLASIFICACION      NUMBER        NOT NULL,
  CONSTRAINT ESPECTACULOS_PK PRIMARY KEY (ID),
  CONSTRAINT FK_E_GENERO FOREIGN KEY (ID_GENERO) REFERENCES GENEROS (ID),
  CONSTRAINT FK_E_FESTIVAL FOREIGN KEY (ID_FESTIVAL) REFERENCES FESTIVAL (ID),
  CONSTRAINT FK_E_CLASIFICACION FOREIGN KEY (ID_CLASIFICACION) REFERENCES CLASIFICACIONES (ID),
  CHECK ( COSTO_REALIZACION > 0 ),
  CHECK ( DURACION > 0 )
);

CREATE TABLE FUNCION
(
  ID             NUMBER NOT NULL,
  FECHA          DATE   NOT NULL,
  ID_ESPECTACULO NUMBER NOT NULL,
  ID_SITIO       NUMBER NOT NULL,
  SE_REALIZA     NUMBER,
  CONSTRAINT FUNCION_PK PRIMARY KEY (ID),
  CONSTRAINT FK_ESPECTACULO FOREIGN KEY (ID_ESPECTACULO) REFERENCES ESPECTACULO (ID),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_SITIO) REFERENCES SITIO (ID)
  -- Realizar Check de rango de fechas
);

CREATE TABLE SITIO
(
  ID                    NUMBER        NOT NULL,
  NOMBRE                VARCHAR2(255) NOT NULL,
  TIPO_ESPACIO          VARCHAR2(255) NOT NULL,
  CAPACIDAD             NUMBER        NOT NULL,
  TIPO_SILLETERIA       VARCHAR2(255) NOT NULL,
  PROTECCION_LLUVIA     NUMBER(0, 1)  NOT NULL,
  DISPONIBILIDAD_INICIO DATE,
  DISPONIBILIDAD_FIN    DATE,
  CONSTRAINT SITIO_PK PRIMARY KEY (ID),
  CHECK ( DISPONIBILIDAD_FIN > DISPONIBILIDAD_INICIO )
);

CREATE TABLE LOCALIDAD
(
  ID   NUMBER             NOT NULL,
  TIPO VARCHAR2(255 BYTE) NOT NULL,
  CONSTRAINT LOCALIDAD_PK PRIMARY KEY (ID)
);

CREATE TABLE SILLA
(
  NUM_FILA     NUMBER NOT NULL,
  NUM_SILLA    NUMBER NOT NULL,
  ID_LOCALIDAD NUMBER NOT NULL,
  ID_LUGAR     NUMBER NOT NULL,
  CONSTRAINT SILLA_PK PRIMARY KEY (NUM_FILA, NUM_SILLA),
  CONSTRAINT FK_LOCALIDAD FOREIGN KEY (ID_LOCALIDAD) REFERENCES LOCALIDAD (ID_LOCALIDAD),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_LUGAR) REFERENCES SITIO (ID),
  CHECK ( NUM_FILA >= 0 ),
  CHECK ( NUM_SILLA >= 0 )
);

CREATE TABLE BOLETA
(
  NUM_BOLETA   NUMBER NOT NULL,
  ID_SILLA     NUMBER NOT NULL,
  ID_FILA      NUMBER NOT NULL,
  ID_LOCALIDAD NUMBER NOT NULL,
  ID_LUGAR     NUMBER NOT NULL,
  FECHA        DATE   NOT NULL,
  ID_USUARIO   NUMBER NOT NULL,
  CONSTRAINT SILLA_PK PRIMARY KEY (NUM_BOLETA),
  CONSTRAINT FK_B_FUNCION FOREIGN KEY (FECHA, ID_LUGAR) REFERENCES FUNCION (FECHA, ID_LUGAR),
  CONSTRAINT FK_B_SILLA FOREIGN KEY (ID_SILLA, ID_FILA, ID_LUGAR, ID_LOCALIDAD) REFERENCES SILLA (NUM_SILLA, NUM_FILA, ID_LOCALIDAD, ID_LUGAR),
  CONSTRAINT FK_B_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO (ID_USUARIO)
);

CREATE TABLE GENEROS
(
  ID     NUMBER        NOT NULL,
  NOMBRE VARCHAR2(255) NOT NULL,
  CONSTRAINT CATEGORIA_PK PRIMARY KEY (ID)
);

CREATE TABLE CLASIFICACIONES
(
  ID   NUMBER        NOT NULL,
  TIPO VARCHAR2(255) NOT NULL,
  CONSTRAINT CLASIFICACION_PK PRIMARY KEY (ID)
);

CREATE TABLE ACCESIBILIDADES
(
  ID     NUMBER        NOT NULL,
  NOMBRE VARCHAR2(255) NOT NULL,
  CONSTRAINT ACCESIBILIDAD_PK PRIMARY KEY (ID)
);

CREATE TABLE REQUERIMIENTO_TECNICO
(
  ID     NUMBER             NOT NULL,
  NOMBRE VARCHAR2(255 BYTE) NOT NULL,
  CONSTRAINT REQUERIMIENTO_TECNICO_PK PRIMARY KEY (ID)
);
--TODO
CREATE TABLE TIENE_USUARIOS
(
  ID_FESTIVAL NUMBER NOT NULL,
  ID_USUARIO  NUMBER NOT NULL,
  CONSTRAINT TIENE_USUARIOS_PK PRIMARY KEY (ID_FESTIVAL, ID_USUARIO),
  CONSTRAINT FK_FESTIVAL FOREIGN KEY (ID_FESTIVAL) REFERENCES FESTIVAL (ID_FESTIVAL),
  CONSTRAINT FK_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO (ID_USUARIO)
);

CREATE TABLE OFRECE
(
  ID_COMPANIA_TEATRO NUMBER NOT NULL,
  ID_ESPECTACULO     NUMBER NOT NULL,
  CONSTRAINT OFRECE_PK PRIMARY KEY (ID_COMPANIA_TEATRO, ID_ESPECTACULO),
  CONSTRAINT FK_COMPANIA_TEATRO FOREIGN KEY (ID_COMPANIA_TEATRO) REFERENCES COMPANIA_TEATRO (ID_COMPANIA_TEATRO),
  CONSTRAINT FK_ESPECTACULO FOREIGN KEY (ID_ESPECTACULO) REFERENCES ESPECTACULO (ID_ESPECTACULO)
);

CREATE TABLE ESPECTACULO_CATEGORIAS
(
  ID_CATEGORIA   NUMBER NOT NULL,
  ID_ESPECTACULO NUMBER NOT NULL,
  CONSTRAINT ESPECTACULO_CATEGORIAS_PK PRIMARY KEY (ID_CATEGORIA, ID_ESPECTACULO),
  CONSTRAINT FK_CATEGORIA FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIA (ID_CATEGORIA),
  CONSTRAINT FK_ESPECTACULO FOREIGN KEY (ID_ESPECTACULO) REFERENCES ESPECTACULO (ID_ESPECTACULO)
);

CREATE TABLE ESPECTACULO_REQ_TECNICOS
(
  ID_REQUERIMIENTO_TECNICO NUMBER NOT NULL,
  ID_ESPECTACULO           NUMBER NOT NULL,
  CONSTRAINT ESPECTACULO_REQ_TECNICOS_PK PRIMARY KEY (ID_REQUERIMIENTO_TECNICO, ID_ESPECTACULO),
  CONSTRAINT FK_REQUERIMIENTO_TECNICO FOREIGN KEY (ID_REQUERIMIENTO_TECNICO) REFERENCES REQUERIMIENTO_TECNICO (ID_REQUERIMIENTO_TECNICO),
  CONSTRAINT FK_ESPECTACULO FOREIGN KEY (ID_ESPECTACULO) REFERENCES ESPECTACULO (ID_ESPECTACULO)
);

CREATE TABLE SITIO_LOCALIDAD
(
  ID_SITIO     NUMBER  NOT NULL,
  ID_LOCALIDAD NUMBER  NOT NULL,
  ES_NUMERADO  BOOLEAN NOT NULL,
  CAPACIDAD    NUMBER  NOT NULL,
  CONSTRAINT SITIO_LOCALIDAD_PK PRIMARY KEY (ID_SITIO, ID_LOCALIDAD),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_SITIO) REFERENCES SITIO (ID_SITIO),
  CONSTRAINT FK_LOCALIDAD FOREIGN KEY (ID_LOCALIDAD) REFERENCES LOCALIDAD (ID_LOCALIDAD),
  CHECK ( CAPACIDAD >= 0 )
);

CREATE TABLE FUNCION_COSTO_LOCALIDAD
(
  ID_FUNCION   NUMBER NOT NULL,
  ID_LOCALIDAD NUMBER NOT NULL,
  COSTO        NUMBER NOT NULL,
  CONSTRAINT FUNCION_COSTO_LOCALIDAD_PK PRIMARY KEY (ID_FUNCION, ID_LOCALIDAD),
  CONSTRAINT FK_FUNCION FOREIGN KEY (ID_FUNCION) REFERENCES FUNCION (ID_FUNCION),
  CONSTRAINT FK_LOCALIDAD FOREIGN KEY (ID_SITIO) REFERENCES LOCALIDAD (ID_LOCALIDAD),
  CHECK ( COSTO >= 0 )
);

CREATE TABLE SITIO_ACCESO_ESPECIAL
(
  ID_SITIO           NUMBER NOT NULL,
  ID_ACCESO_ESPECIAL NUMBER NOT NULL,
  CONSTRAINT SITIO_ACCESO_ESPECIAL_PK PRIMARY KEY (ID_SITIO, ID_ACCESO_ESPECIAL),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_SITIO) REFERENCES SITIO (ID_SITIO),
  CONSTRAINT FK_ACCESO_ESPECIAL FOREIGN KEY (ID_ACCESO_ESPECIAL) REFERENCES ACCESO_ESPECIAL (ID_ACCESO_ESPECIAL)
);

CREATE TABLE SITIO_REQ_TECNICOS
(
  ID_REQUERIMIENTO_TECNICO NUMBER NOT NULL,
  ID_SITIO                 NUMBER NOT NULL,
  CONSTRAINT SITIO_REQ_TECNICOS_PK PRIMARY KEY (ID_REQUERIMIENTO_TECNICO, ID_SITIO),
  CONSTRAINT FK_REQUERIMIENTO_TECNICO FOREIGN KEY (ID_REQUERIMIENTO_TECNICO) REFERENCES REQUERIMIENTO_TECNICO (ID_REQUERIMIENTO_TECNICO),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_SITIO) REFERENCES SITIO (ID_SITIO)
);

CREATE TABLE CLIENTE_PREFERENCIA_CATEGORIAS
(
  ID_USUARIO   NUMBER NOT NULL,
  ID_CATEGORIA NUMBER NOT NULL,
  CONSTRAINT CLIENTE_PREFERENCIA_CATEGORIAS_PK PRIMARY KEY (ID_USUARIO, ID_CATEGORIA),
  CONSTRAINT FK_CLIENTE_REGISTRADO FOREIGN KEY (ID_USUARIO) REFERENCES CLIENTE_REGISTRADO (ID_USUARIO),
  CONSTRAINT FK_CATEGORIA FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIA (ID_CATEGORIA)
);

CREATE TABLE CLIENTE_PREFERENCIA_SITIOS
(
  ID_USUARIO NUMBER NOT NULL,
  ID_SITIO   NUMBER NOT NULL,
  CONSTRAINT CLIENTE_PREFERENCIA_SITIOS_PK PRIMARY KEY (ID_USUARIO, ID_SITIO),
  CONSTRAINT FK_CLIENTE_REGISTRADO FOREIGN KEY (ID_USUARIO) REFERENCES CLIENTE_REGISTRADO (ID_USUARIO),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_SITIO) REFERENCES SITIO (ID_SITIO)
);

COMMIT;