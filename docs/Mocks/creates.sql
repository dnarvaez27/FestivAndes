CREATE TABLE FESTIVAL
(
  ID_FESTIVAL  NUMBER            NOT NULL,
  FECHA_INICIO DATE,
  FECHA_FIN    DATE,
  CIUDAD       VARCHAR2(25 BYTE) NOT NULL,
  CONSTRAINT FESTIVAL_PK PRIMARY KEY (ID_FESTIVAL),
  CHECK ( FECHA_FIN > FECHA_INICIO )
);

CREATE TABLE USUARIO
(
  ID_USUARIO         NUMBER            NOT NULL,
  TIPO_ID            VARCHAR2(10 BYTE) NOT NULL,
  CORREO_ELECTRONICO VARCHAR2(32 BYTE) NOT NULL,
  CONTRASENA         VARCHAR2(15 BYTE),
  NOMBRE             VARCHAR2(40 BYTE) NOT NULL,
  ROL                VARCHAR2(30 BYTE) NOT NULL,
  TELEFONO           NUMBER,
  ID_FESTIVAL        NUMBER            NOT NULL,
  CONSTRAINT USUARIO_PK PRIMARY KEY (ID_USUARIO, TIPO_ID),
  CONSTRAINT FK_FESTIVAL FOREIGN KEY (ID_FESTIVAL) REFERENCES FESTIVAL (ID_FESTIVAL),
  CHECK (ROL IN ( 'Administrador', 'Organizador', 'Usuario No-Registrado', 'Usuario Registrado', 'Compania De Teatro' ) )
);

CREATE TABLE CLIENTE_REGISTRADO
(
  ID_USUARIO NUMBER NOT NULL,
  EDAD       NUMBER NOT NULL,
  CONSTRAINT CLIENTE_REGISTRADO_PK PRIMARY KEY (ID_USUARIO),
  CHECK ( EDAD > 0 )
);

CREATE TABLE COMPANIA_TEATRO
(
  ID_COMPANIA   NUMBER             NOT NULL,
  NOMBRE        VARCHAR2(255 BYTE) NOT NULL,
  REPRESENTANTE VARCHAR2(255 BYTE) NOT NULL,
  PAIS          VARCHAR2(255 BYTE) NOT NULL,
  PAGINA_WEB    VARCHAR2(255 BYTE),
  FECHA_LLEGADA DATE               NOT NULL,
  FECHA_SALIDA  DATE               NOT NULL,
  CONSTRAINT COMPANIA_PK PRIMARY KEY (ID_COMPANIA),
  CHECK ( FECHA_SALIDA > FECHA_LLEGADA )
);

CREATE TABLE ESPECTACULO
(
  ID_ESPECTACULO        NUMBER             NOT NULL,
  NOMBRE                VARCHAR2(255 BYTE) NOT NULL,
  DURACION              NUMBER             NOT NULL,
  IDIOMA                VARCHAR2(255 BYTE) NOT NULL,
  COSTO_REALIZACION     NUMBER             NOT NULL,
  PARTICIPACION_PUBLICO NUMBER(0, 1),
  DESCRIPCION           VARCHAR2(255 BYTE) NOT NULL,
  ID_CATEGORIA          NUMBER             NOT NULL,
  ID_FESTIVAL           NUMBER             NOT NULL,
  ID_PUBLICO_OBJETIVO   NUMBER             NOT NULL,
  CONSTRAINT ESPECTACULOS_PK PRIMARY KEY (ID_ESPECTACULO),
  CONSTRAINT FK_CATEGORIA FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIA (ID_CATEGORIA),
  CONSTRAINT FK_FESTIVAL FOREIGN KEY (ID_FESTIVAL) REFERENCES FESTIVAL (ID_FESTIVAL),
  CONSTRAINT FK_PUBLICO_OBJETIVO FOREIGN KEY (ID_PUBLICO_OBJETIVO) REFERENCES PUBLICO_OBJETIVO (ID_PUBLICO_OBJETIVO),
  CHECK ( COSTO_REALIZACION > 0 ),
  CHECK ( DURACION > 0 )
);

CREATE TABLE FUNCION
(
  ID_FUNCION     NUMBER NOT NULL,
  FECHA          DATE   NOT NULL,
  ID_ESPECTACULO NUMBER NOT NULL,
  ID_SITIO       NUMBER NOT NULL,
  CONSTRAINT FUNCION_PK PRIMARY KEY (ID_FUNCION),
  CONSTRAINT FK_ESPECTACULO FOREIGN KEY (ID_ESPECTACULO) REFERENCES ESPECTACULO (ID_ESPECTACULO),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_SITIO) REFERENCES SITIO (ID_SITIO)
  -- Realizar Check de rango de fechas
);

CREATE TABLE SITIO
(
  ID_SITIO              NUMBER             NOT NULL,
  NOMBRE                VARCHAR2(255 BYTE) NOT NULL,
  TIPO_ESPACIO          VARCHAR2(255 BYTE) NOT NULL,
  CAPACIDAD             NUMBER             NOT NULL,
  TIPO_SILLETERIA       VARCHAR2(255 BYTE) NOT NULL,
  PROTECCION_LLUVIA     NUMBER(0, 1)       NOT NULL,
  DISPONIBILIDAD_INICIO DATE,
  DISPONIBILIDAD_FIN    DATE,
  CONSTRAINT SITIO_PK PRIMARY KEY (ID_SITIO),
  CHECK ( DISPONIBILIDAD_FIN > DISPONIBILIDAD_INICIO )
);

CREATE TABLE LOCALIDAD
(
  ID_LOCALIDAD NUMBER             NOT NULL,
  TIPO         VARCHAR2(255 BYTE) NOT NULL,
  CONSTRAINT LOCALIDAD_PK PRIMARY KEY (ID_LOCALIDAD)
);

CREATE TABLE SILLA
(
  NUM_FILA     NUMBER NOT NULL,
  POSICION     NUMBER NOT NULL,
  ID_LOCALIDAD NUMBER NOT NULL,
  ID_SITIO     NUMBER NOT NULL,
  CONSTRAINT SILLA_PK PRIMARY KEY (NUM_FILA, POSICION),
  CONSTRAINT FK_LOCALIDAD FOREIGN KEY (ID_LOCALIDAD) REFERENCES LOCALIDAD (ID_LOCALIDAD),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_SITIO) REFERENCES SITIO (ID_SITIO),
  CHECK ( NUM_FILA >= 0 ),
  CHECK ( POSICION >= 0 )
);

CREATE TABLE BOLETA
(
  ID_BOLETA       NUMBER NOT NULL,
  COSTO           NUMBER NOT NULL,
  FECHA_DE_COMPRA DATE   NOT NULL,
  OBSERVACIONES   VARCHAR2(255 BYTE),
  ID_FUNCION      NUMBER NOT NULL,
  NUM_FILA        NUMBER NOT NULL,
  POSICION        NUMBER NOT NULL,
  ID_LOCALIDAD    NUMBER NOT NULL,
  ID_SITIO        NUMBER NOT NULL,
  ID_USUARIO      NUMBER NOT NULL,
  CONSTRAINT SILLA_PK PRIMARY KEY (NUM_FILA, POSICION),
  CONSTRAINT FK_FUNCION FOREIGN KEY (ID_FUNCION) REFERENCES FUNCION (ID_FUNCION),
  CONSTRAINT FK_SILLA FOREIGN KEY (NUM_FILA, POSICION, ID_LOCALIDAD, ID_SITIO) REFERENCES SILLA (NUM_FILA, POSICION, ID_LOCALIDAD, ID_SITIO),
  CONSTRAINT FK_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO (ID_USUARIO),
  CHECK ( COSTO >= 0 )
);

CREATE TABLE CATEGORIA
(
  ID_CATEGORIA NUMBER             NOT NULL,
  NOMBRE       VARCHAR2(255 BYTE) NOT NULL,
  CONSTRAINT CATEGORIA_PK PRIMARY KEY (ID_CATEGORIA)
);

CREATE TABLE PUBLICO_OBJETIVO
(
  ID_PUBLICO_OBJETIVO NUMBER             NOT NULL,
  TIPO                VARCHAR2(255 BYTE) NOT NULL,
  CONSTRAINT PUBLICO_OBJETIVO PRIMARY KEY (ID_PUBLICO_OBJETIVO)
);

CREATE TABLE ACCESO_ESPECIAL
(
  ID_ACCESO_ESPECIAL NUMBER             NOT NULL,
  TIPO_ACCESO        VARCHAR2(255 BYTE) NOT NULL,
  CONSTRAINT ACCESO_ESPECIAL_PK PRIMARY KEY (ID_ACCESO_ESPECIAL)
);

CREATE TABLE REQUERIMIENTO_TECNICO
(
  ID_REQUERIMIENTO_TECNICO NUMBER             NOT NULL,
  NOMBRE                   VARCHAR2(255 BYTE) NOT NULL,
  CONSTRAINT REQUERIMIENTO_TECNICO_PK PRIMARY KEY (ID_REQUERIMIENTO_TECNICO)
);

CREATE TABLE TIENE_USUARIOS
(
  ID_FESTIVAL NUMBER NOT NULL,
  ID_USUARIO  NUMBER NOT NULL,
  CONSTRAINT TIENE_USUARIOS_PK PRIMARY KEY (ID_FESTIVAL, ID_USUARIO),
  CONSTRAINT FK_FESTIVAL FOREIGN KEY (ID_FESTIVAL) REFERENCES FESTIVAL (ID_FESTIVAL),
  CONSTRAINT FK_USUARIO FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO (ID_USUARIO)
);

CREATE TABLE OFRECE
(
  ID_COMPANIA_TEATRO NUMBER NOT NULL,
  ID_ESPECTACULO     NUMBER NOT NULL,
  CONSTRAINT OFRECE_PK PRIMARY KEY (ID_COMPANIA_TEATRO, ID_ESPECTACULO),
  CONSTRAINT FK_COMPANIA_TEATRO FOREIGN KEY (ID_COMPANIA_TEATRO) REFERENCES COMPANIA_TEATRO (ID_COMPANIA_TEATRO),
  CONSTRAINT FK_ESPECTACULO FOREIGN KEY (ID_ESPECTACULO) REFERENCES ESPECTACULO (ID_ESPECTACULO)
);

CREATE TABLE ESPECTACULO_CATEGORIAS
(
  ID_CATEGORIA   NUMBER NOT NULL,
  ID_ESPECTACULO NUMBER NOT NULL,
  CONSTRAINT ESPECTACULO_CATEGORIAS_PK PRIMARY KEY (ID_CATEGORIA, ID_ESPECTACULO),
  CONSTRAINT FK_CATEGORIA FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIA (ID_CATEGORIA),
  CONSTRAINT FK_ESPECTACULO FOREIGN KEY (ID_ESPECTACULO) REFERENCES ESPECTACULO (ID_ESPECTACULO)
);

CREATE TABLE ESPECTACULO_REQ_TECNICOS
(
  ID_REQUERIMIENTO_TECNICO NUMBER NOT NULL,
  ID_ESPECTACULO           NUMBER NOT NULL,
  CONSTRAINT ESPECTACULO_REQ_TECNICOS_PK PRIMARY KEY (ID_REQUERIMIENTO_TECNICO, ID_ESPECTACULO),
  CONSTRAINT FK_REQUERIMIENTO_TECNICO FOREIGN KEY (ID_REQUERIMIENTO_TECNICO) REFERENCES REQUERIMIENTO_TECNICO (ID_REQUERIMIENTO_TECNICO),
  CONSTRAINT FK_ESPECTACULO FOREIGN KEY (ID_ESPECTACULO) REFERENCES ESPECTACULO (ID_ESPECTACULO)
);

CREATE TABLE SITIO_LOCALIDAD
(
  ID_SITIO     NUMBER  NOT NULL,
  ID_LOCALIDAD NUMBER  NOT NULL,
  ES_NUMERADO  BOOLEAN NOT NULL,
  CAPACIDAD    NUMBER  NOT NULL,
  CONSTRAINT SITIO_LOCALIDAD_PK PRIMARY KEY (ID_SITIO, ID_LOCALIDAD),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_SITIO) REFERENCES SITIO (ID_SITIO),
  CONSTRAINT FK_LOCALIDAD FOREIGN KEY (ID_LOCALIDAD) REFERENCES LOCALIDAD (ID_LOCALIDAD),
  CHECK ( CAPACIDAD >= 0 )
);

CREATE TABLE FUNCION_COSTO_LOCALIDAD
(
  ID_FUNCION   NUMBER NOT NULL,
  ID_LOCALIDAD NUMBER NOT NULL,
  COSTO        NUMBER NOT NULL,
  CONSTRAINT FUNCION_COSTO_LOCALIDAD_PK PRIMARY KEY (ID_FUNCION, ID_LOCALIDAD),
  CONSTRAINT FK_FUNCION FOREIGN KEY (ID_FUNCION) REFERENCES FUNCION (ID_FUNCION),
  CONSTRAINT FK_LOCALIDAD FOREIGN KEY (ID_SITIO) REFERENCES LOCALIDAD (ID_LOCALIDAD),
  CHECK ( COSTO >= 0 )
);

CREATE TABLE SITIO_ACCESO_ESPECIAL
(
  ID_SITIO           NUMBER NOT NULL,
  ID_ACCESO_ESPECIAL NUMBER NOT NULL,
  CONSTRAINT SITIO_ACCESO_ESPECIAL_PK PRIMARY KEY (ID_SITIO, ID_ACCESO_ESPECIAL),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_SITIO) REFERENCES SITIO (ID_SITIO),
  CONSTRAINT FK_ACCESO_ESPECIAL FOREIGN KEY (ID_ACCESO_ESPECIAL) REFERENCES ACCESO_ESPECIAL (ID_ACCESO_ESPECIAL)
);

CREATE TABLE SITIO_REQ_TECNICOS
(
  ID_REQUERIMIENTO_TECNICO NUMBER NOT NULL,
  ID_SITIO                 NUMBER NOT NULL,
  CONSTRAINT SITIO_REQ_TECNICOS_PK PRIMARY KEY (ID_REQUERIMIENTO_TECNICO, ID_SITIO),
  CONSTRAINT FK_REQUERIMIENTO_TECNICO FOREIGN KEY (ID_REQUERIMIENTO_TECNICO) REFERENCES REQUERIMIENTO_TECNICO (ID_REQUERIMIENTO_TECNICO),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_SITIO) REFERENCES SITIO (ID_SITIO)
);

CREATE TABLE CLIENTE_PREFERENCIA_CATEGORIAS
(
  ID_USUARIO   NUMBER NOT NULL,
  ID_CATEGORIA NUMBER NOT NULL,
  CONSTRAINT CLIENTE_PREFERENCIA_CATEGORIAS_PK PRIMARY KEY (ID_USUARIO, ID_CATEGORIA),
  CONSTRAINT FK_CLIENTE_REGISTRADO FOREIGN KEY (ID_USUARIO) REFERENCES CLIENTE_REGISTRADO (ID_USUARIO),
  CONSTRAINT FK_CATEGORIA FOREIGN KEY (ID_CATEGORIA) REFERENCES CATEGORIA (ID_CATEGORIA)
);

CREATE TABLE CLIENTE_PREFERENCIA_SITIOS
(
  ID_USUARIO NUMBER NOT NULL,
  ID_SITIO   NUMBER NOT NULL,
  CONSTRAINT CLIENTE_PREFERENCIA_SITIOS_PK PRIMARY KEY (ID_USUARIO, ID_SITIO),
  CONSTRAINT FK_CLIENTE_REGISTRADO FOREIGN KEY (ID_USUARIO) REFERENCES CLIENTE_REGISTRADO (ID_USUARIO),
  CONSTRAINT FK_SITIO FOREIGN KEY (ID_SITIO) REFERENCES SITIO (ID_SITIO)
);

COMMIT;X